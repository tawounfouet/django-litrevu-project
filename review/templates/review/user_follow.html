{% extends 'base2.html' %} 
{% load crispy_forms_tags %} 

{% block title%}
<p>Gestion des abonnements</p>
{% endblock title%} 

{% block content %}
<!-- <div class="row">
  <div class="col-md-6">
      <h4 class="text-center">Feeds </h4>
  </div>
  <div class="col-md-6">
      <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Rechercher un film" aria-label="Recipient's username"
              aria-describedby="button-addon2">
          <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button" id="button-addon2">Rechercher</button>
          </div>
      </div>
  </div> -->


<!-- Rajouter de la marge bootstrap : m-5 -->
<div class="container m-4">
  <h4>Suivre d'autres utilisateurs</h4>
  <div class="row">
    <div class="col-md-8"> 
      <form method="post">
        {% csrf_token %} 
        {{ form|crispy }}
      </div>
     
    <div class="col-md-4">
      <button  class="btn btn-outline-primary" type="submit">Envoyer</button>
      <!-- <a class="btn btn-outline-primary" href="#">Créer une critique </a> -->
    </div>
  </div>

    {% if form.errors %}
    <div class="alert alert-danger">
      {{ form.non_field_errors }}
      {{ form.user_to_follow.errors }}
    </div>
    {% endif %}

        <!-- Message from Backend -->
        {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
  </form>

  {% if form.errors %}
  <div class="alert alert-danger">
    {{ form.non_field_errors }} {{ form.user_to_follow.errors }}
  </div>
  {% endif %}
</div>



<div class="container m-5">
    <h4>Utilisateurs que vous suivez</h4>
  <ul>
    {% for follow in user_following %}
        <li >
            {{ follow.followed_user.username }}

            {% comment %} <a href="{% url 'review:unfollow_user' user_id=follow.followed_user.id %}" class="btn btn-sm btn-danger mb-2">
              Désabonner
            </a> {% endcomment %}

            

            <form method="post" action="{% url 'review:user_unfollow' unfollow.id %}/">

              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger mb-2">
                  Désabonner
              </button>
            </form>

            </br>

          
        </li>
        {% empty %}
        <li>Vous ne suivez personne pour le moment.</li>
    {% endfor %}
    </ul>
</div>


<div class="container m-5">
    <h4>Utilisateurs qui vous suivent</h4>
    <ul>
      {% for follow in user_followers %}
        <li>{{ follow.user.username }}</li>
      {% empty %}
        <li>Personne ne vous suit pour le moment.</li>
      {% endfor %}
    </ul>
</div>



<script>
    // Cette fonction masque les messages après un certain délai
    function hideMessages() {
      setTimeout(function() {
        var messages = document.querySelectorAll('.alert');
        messages.forEach(function(message) {
          message.style.display = 'none';
        });
      }, 1000); // Messages disparaissent après 3 secondes (3000 millisecondes)
    }
  
    // Appelez la fonction une fois que la page est chargée
    window.onload = hideMessages;
  </script>
{% endblock %}



